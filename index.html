<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<script src="js/InputKeyboard.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/89/three.min.js"></script>
<script src="js/GameUtil.js"></script>
<script src="js/GameObject.js"></script>
<script src="js/Player.js"></script>
<script src="js/Other.js"></script>
<script src="js/Wall.js"></script>  
<script src="js/Floor.js"></script>
<script src="js/InitMap.js"></script>
<script src="js/MiniMap.js"></script>
<script src="js/JumpItem.js"></script>
<script src="js/MapItem.js"></script>
<script src="js/SpeedItem.js"></script>

<script>
// wait html load
window.addEventListener('load', init);

function init() {
  // set size
  const width = 960;
  const height = 540;

  // create renderer
  const renderer = new THREE.WebGLRenderer({
    canvas: document.querySelector('#myCanvas'),
  });
  renderer.setPixelRatio(window.devicePixelRatio);
  renderer.setSize(width, height);
  renderer.setClearColor(0xF9F9F9, 1.0);

  // create camera
  const camera = new THREE.PerspectiveCamera(45, width / height);

  // create light
  const light = new THREE.DirectionalLight(0xFFFFFF, 1);
  light.position.set(1, 1, 1);
  scene.add(light);

  const light2 = new THREE.HemisphereLight(0x888888, 0x0000FF, 1.0);
  scene.add(light2);

  // initialize map
  InitMap();

  // create item
  let jumpitem = new JumpItem();
  jumpitem.start(new THREE.Vector3(152, 2, 15));

  let mapitem = new MapItem();
  mapitem.start(new THREE.Vector3(106, 2, 34));

  let speeditem = new SpeedItem();
  speeditem.start(new THREE.Vector3(168, 2, 7));

  // create player
  let player = new Player();
  player.start(new THREE.Vector3(148, 4, 38));

  // create other player
  let other = new Other();
  other.start(new THREE.Vector3(123, 4, 38));

  // create floor
  const floor = new Floor();
  floor.mesh.position.set(0, -5, 0);
  
  // create minimap
  const minimap = new MiniMap();

  // loop event
  tick();

  // one frame process
  function tick() {
    minimap.update(player.pos);
    minimap.clearMiniMap();
    for (let obj of GameObjectTbl) {
      obj.update();
      player.hitCheck(obj);
      if (player.mapCount > 0 && obj.isVisible) {
        minimap.drawObj(obj);
      }
    }

    camera.position.set(player.pos.x, player.pos.y, player.pos.z);
    camera.lookAt(player.getLookAtVector());

    // rendering
    renderer.render(scene, camera);
    requestAnimationFrame(tick);
  }
}
</script>
</head>
<body>
<canvas id="myCanvas" style="position:fixed; top:0px; left:0px; width:960; height:540; z-index: 1; background-color: #000000;"></canvas>
<canvas id="miniMap" style="position:fixed; top:340px; left:10px; width:160px; height:160px; z-index: 2; background-color:rgba(0,0,0,0);"></canvas>
</body>
</html>
